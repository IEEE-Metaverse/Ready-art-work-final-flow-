<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI/UX Competitive Analysis Results - Competitor Web UI UX</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header with Steps -->
    <header class="wizard-header results-header">
        <div class="container">
            <div class="brand-section">
                <div class="brand-icon">3</div>
                <div class="brand-info">
                    <h1>Competitor Web UI UX</h1>
                    <p>Data-Driven Competitive Analysis</p>
                </div>
            </div>
            
            <div class="steps-navigation">
                <div class="step active">STEP 1</div>
                <div class="step active">STEP 2</div>
                <div class="step active">STEP 3</div>
                <div class="step current">STEP 4</div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Hero Section -->
            <section class="results-hero">
                <h2>UI/UX Competitive Analysis Results</h2>
                <p>Detailed comparison metrics to identify strengths, weaknesses, and optimization opportunities</p>
            </section>

            <!-- Metrics Container -->
            <div class="metrics-container">
                <div class="metrics-header">
                    <div class="header-icon">üìä</div>
                    UI/UX Metrics
                </div>

                <table class="metrics-table">
                    <thead>
                        <tr>
                            <th>Website URL</th>
                            {% for result in results %}
                            <th class="website-column">
                                <div class="website-info">
                                    <div class="company-name">{{ get_company_name(result.url) }}</div>
                                    <div class="website-url">{{ result.url }}</div>
                                    <div class="status-indicator {{ 'success' if result.status == 'success' else 'error' }}">
                                        {{ result.status.upper() }}
                                    </div>
                                </div>
                            </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Overall Score -->
                        <tr>
                            <th>Overall UI/UX Score</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-value">{{ extract_overall_score(result.content) or 'N/A' }}</div>
                                {% else %}
                                    <div class="error-indicator">Error</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Website Overview -->
                        <tr>
                            <th>Website Overview</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-description">{{ extract_website_description(result.content) }}</div>
                                {% else %}
                                    <div class="error-description">{{ result.error or 'Analysis failed' }}</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- User Experience Analysis -->
            <div class="metrics-container">
                <div class="metrics-header section-header">
                    üë§ USER EXPERIENCE ANALYSIS
                </div>

                <table class="metrics-table">
                    <tbody>
                        <!-- Consumer Appeal Score -->
                        <tr>
                            <th>Consumer Appeal Score</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-value">{{ extract_audience_score(result.content) or 'N/A' }}</div>
                                    <div class="score-description">{{ extract_audience_description(result.content) or 'Consumer experience analysis' }}</div>
                                {% else %}
                                    <div class="error-indicator">Error</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Consumer Experience Analysis -->
                        <tr>
                            <th>Consumer Experience Analysis</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-description">{{ extract_audience_description(result.content) or 'Detailed consumer experience assessment' }}</div>
                                {% else %}
                                    <div class="error-description">Analysis unavailable</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Technical Implementation Score -->
                        <tr>
                            <th>Technical Implementation Score</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-value">{{ extract_developer_score(result.content) or 'N/A' }}</div>
                                    <div class="score-description">{{ extract_developer_description(result.content) or 'Technical assessment' }}</div>
                                {% else %}
                                    <div class="error-indicator">Error</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Technical Assessment -->
                        <tr>
                            <th>Technical Assessment</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-description">{{ extract_developer_description(result.content) or 'Technical implementation evaluation' }}</div>
                                {% else %}
                                    <div class="error-description">Analysis unavailable</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Business Impact Score -->
                        <tr>
                            <th>Business Impact Score</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-value">{{ extract_investor_score(result.content) or 'N/A' }}</div>
                                    <div class="score-description">{{ extract_investor_description(result.content) or 'Business value analysis' }}</div>
                                {% else %}
                                    <div class="error-indicator">Error</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Business Value Analysis -->
                        <tr>
                            <th>Business Value Analysis</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-description">{{ extract_investor_description(result.content) or 'Business impact assessment' }}</div>
                                {% else %}
                                    <div class="error-description">Analysis unavailable</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Design & Usability Metrics -->
            <div class="metrics-container">
                <div class="metrics-header section-header">
                    üé® DESIGN & USABILITY METRICS
                </div>

                <table class="metrics-table">
                    <tbody>
                        <!-- Content Clarity Score -->
                        <tr>
                            <th>Content Clarity Score</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-value">{{ extract_clarity_score(result.content) or 'N/A' }}</div>
                                    <div class="score-description">{{ extract_clarity_description(result.content) or 'Content clarity assessment' }}</div>
                                {% else %}
                                    <div class="error-indicator">Error</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Content & Information Architecture -->
                        <tr>
                            <th>Content & Information Architecture</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-description">{{ extract_clarity_description(result.content) or 'Information architecture evaluation' }}</div>
                                {% else %}
                                    <div class="error-description">Analysis unavailable</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Visual Design Score -->
                        <tr>
                            <th>Visual Design Score</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-value">{{ extract_visual_design_score(result.content) or 'N/A' }}</div>
                                    <div class="score-description">{{ extract_visual_design_description(result.content) or 'Visual design assessment' }}</div>
                                {% else %}
                                    <div class="error-indicator">Error</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Visual Design Assessment -->
                        <tr>
                            <th>Visual Design Assessment</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-description">{{ extract_visual_design_description(result.content) or 'Visual design evaluation' }}</div>
                                {% else %}
                                    <div class="error-description">Analysis unavailable</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- User Experience Score -->
                        <tr>
                            <th>User Experience Score</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-value">{{ extract_ux_score(result.content) or 'N/A' }}</div>
                                    <div class="score-description">{{ extract_ux_description(result.content) or 'UX analysis' }}</div>
                                {% else %}
                                    <div class="error-indicator">Error</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- UX & Navigation Analysis -->
                        <tr>
                            <th>UX & Navigation Analysis</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-description">{{ extract_ux_description(result.content) or 'Navigation and usability evaluation' }}</div>
                                {% else %}
                                    <div class="error-description">Analysis unavailable</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Trust & Credibility Score -->
                        <tr>
                            <th>Trust & Credibility Score</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-value">{{ extract_trust_score(result.content) or 'N/A' }}</div>
                                    <div class="score-description">{{ extract_trust_description(result.content) or 'Trust analysis' }}</div>
                                {% else %}
                                    <div class="error-indicator">Error</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Trust Indicators Assessment -->
                        <tr>
                            <th>Trust Indicators Assessment</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-description">{{ extract_trust_description(result.content) or 'Trust and credibility evaluation' }}</div>
                                {% else %}
                                    <div class="error-description">Analysis unavailable</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Value Communication Score -->
                        <tr>
                            <th>Value Communication Score</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-value">{{ extract_value_prop_score(result.content) or 'N/A' }}</div>
                                    <div class="score-description">{{ extract_value_prop_description(result.content) or 'Value proposition analysis' }}</div>
                                {% else %}
                                    <div class="error-indicator">Error</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>

                        <!-- Value Proposition Clarity -->
                        <tr>
                            <th>Value Proposition Clarity</th>
                            {% for result in results %}
                            <td>
                                {% if result.status == 'success' %}
                                    <div class="score-description">{{ extract_value_prop_description(result.content) or 'Value communication assessment' }}</div>
                                {% else %}
                                    <div class="error-description">Analysis unavailable</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Analysis Complete Banner -->
            <div class="completion-banner">
                <h3>Analysis Complete!</h3>
                <p>Review your competitive analysis results above. When ready, proceed to Step 4 for optimization recommendations.</p>
                <button class="continue-btn" onclick="window.location.href='/'">
                    Continue to Step 4 ‚Üí
                </button>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons" style="margin-top: 2rem;">
                <button onclick="downloadExcel()" class="start-analysis-btn">
                    üìä Download this Data
                </button>
                <button onclick="window.location.href='/'" class="stop-analysis-btn" style="display: inline-flex;">
                    üè† Analyze More Websites
                </button>
            </div>

            <!-- Raw Data Section (Collapsible) -->
            <div class="raw-data-section" style="margin-top: 3rem;">
                <button onclick="toggleRawData()" class="add-competitor-btn" style="margin-bottom: 1rem;">
                    üìÑ Show Raw Analysis Data
                </button>
                <div id="rawDataContainer" style="display: none;">
                    {% for result in results %}
                    <div style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; border: 1px solid #e8eaed;">
                        <h4 style="color: #1a73e8; margin-bottom: 1rem;">{{ result.url }}</h4>
                        {% if result.status == 'success' %}
                        <pre style="background: #f8f9fa; padding: 1rem; border-radius: 6px; font-size: 12px; line-height: 1.5; overflow-x: auto;">{{ result.content }}</pre>
                        {% else %}
                        <div style="background: #fce8e6; color: #d93025; padding: 1rem; border-radius: 6px;">
                            <strong>Error:</strong> {{ result.error or 'Unknown error occurred' }}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </main>

    <!-- Store data safely in a script tag -->
    <script type="application/json" id="results-data">{{ results | tojson }}</script>
    
    <script>
        function toggleRawData() {
            const container = document.getElementById('rawDataContainer');
            const button = document.querySelector('.add-competitor-btn');
            
            if (container.style.display === 'none') {
                container.style.display = 'block';
                button.innerHTML = 'üìÑ Hide Raw Analysis Data';
            } else {
                container.style.display = 'none';
                button.innerHTML = 'üìÑ Show Raw Analysis Data';
            }
        }

        function downloadExcel() {
            try {
                // Get the raw results data for detailed content
                const dataElement = document.getElementById('results-data');
                const resultsData = JSON.parse(dataElement.textContent);
                
                let csvContent = '\uFEFF'; // BOM for Excel UTF-8 support
                
                // Headers
                const headers = ['Metric'];
                resultsData.forEach(function(result) {
                    const companyName = extractCompanyName(result.url);
                    headers.push('"' + companyName + '"');
                });
                csvContent += headers.join(',') + '\n';
                
                // URL row
                let urlRow = ['"Website URL"'];
                resultsData.forEach(function(result) {
                    urlRow.push('"' + result.url + '"');
                });
                csvContent += urlRow.join(',') + '\n';
                
                // Status row
                let statusRow = ['"Status"'];
                resultsData.forEach(function(result) {
                    statusRow.push('"' + result.status.toUpperCase() + '"');
                });
                csvContent += statusRow.join(',') + '\n';
                
                // Data rows
                const metrics = [
                    'Overall UI/UX Score',
                    'Website Overview', 
                    'Consumer Appeal Score',
                    'Technical Implementation Score',
                    'Business Impact Score',
                    'Content Clarity Score',
                    'Visual Design Score',
                    'User Experience Score',
                    'Trust & Credibility Score',
                    'Value Communication Score'
                ];
                
                metrics.forEach(function(metric) {
                    let row = ['"' + metric + '"'];
                    resultsData.forEach(function(result) {
                        if (result.status === 'success') {
                            // Extract relevant data based on metric
                            let value = extractMetricValue(result.content, metric);
                            row.push('"' + (value || 'N/A') + '"');
                        } else {
                            row.push('"Error"');
                        }
                    });
                    csvContent += row.join(',') + '\n';
                });
                
                // Download file
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                
                const now = new Date();
                const timestamp = now.getFullYear() + 
                                (now.getMonth() + 1).toString().padStart(2, '0') + 
                                now.getDate().toString().padStart(2, '0') + '_' +
                                now.getHours().toString().padStart(2, '0') + 
                                now.getMinutes().toString().padStart(2, '0');
                
                link.setAttribute('download', 'Competitor_Analysis_Results_' + timestamp + '.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
            } catch (error) {
                alert('Error downloading file: ' + error.message);
            }
        }
        
        function extractCompanyName(url) {
            try {
                const clean_url = url.replace(/https?:\/\//, '').replace(/^www\./, '');
                const domain = clean_url.split('/')[0];
                const name = domain.split('.')[0];
                return name.charAt(0).toUpperCase() + name.slice(1).replace(/-/g, ' ');
            } catch {
                return 'Unknown';
            }
        }
        
        function extractMetricValue(content, metric) {
            if (!content) return '';
            
            // Simple extraction based on metric type
            const text = content.toLowerCase();
            
            if (metric.includes('Score')) {
                // Look for score patterns
                const patterns = [/score[:\s]*(\d+\.?\d*)/g, /(\d+\.?\d*)\s*score/g];
                for (let pattern of patterns) {
                    const match = pattern.exec(text);
                    if (match) return match[1];
                }
            }
            
            // Return first meaningful line for descriptions
            const lines = content.split('\n');
            for (let line of lines) {
                line = line.trim();
                if (line.length > 20 && !line.match(/^(score|rating|\d+\.?\d*$)/i)) {
                    return line.substring(0, 100) + (line.length > 100 ? '...' : '');
                }
            }
            
            return 'Analysis completed';
        }
    </script>
</body>
</html>
